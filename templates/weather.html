<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather & Insights</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<style>
    body {
        background: linear-gradient(135deg, #6dd5ed, #2193b0);
        color: #000;
        font-family: Arial, sans-serif;
        min-height: 100vh;
    }
    .card { 
        border-radius: 15px; 
        background-color: #f8f9fa;
        color: #212529;
    }
    .alert-card {
        background-color: #fff3cd;
        border-color: #ffc34d;
        color: #664d03;
        font-weight: bold;
    }
    .insights-section h5 {
        color: #007bff;
        border-bottom: 2px solid #007bff;
        padding-bottom: 5px;
        margin-top: 15px;
    }
</style>
<body>
    <div class="container py-5">
        <div class="text-center mb-4">
            <a href="/" class="btn btn-dark">üè† Back to Home</a>
        </div>
        
        <h2 class="text-center mb-5 text-white">‚òÅÔ∏è AI-Powered Weather Insights</h2>

        {% if error %}
            <div class="alert alert-danger text-center shadow-lg" role="alert">
                <strong>Error:</strong> {{ error }}
            </div>
        {% elif weather and ai_insights %}
            <div class="card shadow-lg p-4 mb-4">
                <h4 class="text-center mb-3">Current Weather in <strong>{{ weather.city }}</strong></h4>
                <div class="row text-center">
                    <div class="col-md-4">
                        <p class="mb-0">üå°Ô∏è **Temperature**</p>
                        <h3 class="display-6">{{ '%.1f' | format(weather.temperature) }}¬∞C</h3>
                        <p>Feels like: {{ '%.1f' | format(weather.feels_like) }}¬∞C</p>
                    </div>
                    <div class="col-md-4">
                        <p class="mb-0">üíß **Humidity**</p>
                        <h3 class="display-6">{{ weather.humidity }}%</h3>
                        <p>{{ weather.description | capitalize }}</p>
                    </div>
                    <div class="col-md-4">
                        <p class="mb-0">üí® **Wind & Pressure**</p>
                        <h3 class="display-6">{{ '%.1f' | format(weather.wind_speed) }} m/s</h3>
                        <p>{{ weather.pressure }} hPa</p>
                    </div>
                </div>
            </div>

            <div class="card shadow-lg p-4 insights-section">
                <h4 class="text-center mb-4 text-success">ü§ñ Agricultural Insights & Alert</h4>
                
                {% set parts = ai_insights.split('2. ALERT:') %}
                {% set summary_text = parts[0] if parts | length > 0 else ai_insights %}
                {% set remaining = parts[1] if parts | length > 1 else '' %}

                {% set parts2 = remaining.split('3. TIPS:') %}
                {% set alert_text = parts2[0] if parts2 | length > 0 else remaining %}
                {% set tips_text = parts2[1] if parts2 | length > 1 else '' %}

                <h5>SUMMARY:</h5>
                <p>{{ summary_text.replace('1. SUMMARY:', '').strip() | nl2br }}</p>

                <div class="alert alert-card mb-3">
                    <p class="mb-0">üö® **WEATHER ALERT:**</p>
                    <p class="mb-0">{{ alert_text.strip() | nl2br }}</p>
                </div>

                <h5>TIPS:</h5>
                <p>{{ tips_text.strip() | nl2br }}</p>
            </div>
            
        {% else %}
            <div class="alert alert-info text-center shadow-lg" role="alert">
                Enter a city name to get the weather forecast and AI-powered agricultural insights.
            </div>
        {% endif %}
    </div>
    
    <script>
        // Simple filter to replace numbered lists with actual HTML lists for better rendering (optional, Groq's formatting is usually good)
        function nl2br(str) {
            return str.replace(/(?:\r\n|\r|\n)/g, '<br>');
        }
    </script>
</body>
</html>